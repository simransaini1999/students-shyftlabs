<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Student View</title>
	<link rel="stylesheet" href="styles.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body onload="load()">
	<div class="sidebar">
		<a href="main.html" class="active">Home</a>
		<a href="#students">Students</a>
	</div>

	<form id="addStudentForm">
		<label for="fname">First Name:</label>
		<input type="text" id="fname" name="fname" required><br>
		<label for="lname">Last Name:</label>
		<input type="text" id="lname" name="lname" required><br>
		<label for="age">Date of Birth:</label>
		<input type="date" id="age" name="age" required><br> <!-- Changed type to 'date' -->
		<input type="submit" value="Add Student">
	</form>
	<p id="confirmationMessage"></p>

	<table id="studentsTable">
		<thead>
			<tr>
				<th>ID</th>
				<th>First Name</th>
				<th>Last Name</th>
				<th>Age</th>
			</tr>
		</thead>
		<tbody>

		</tbody>
	</table>

	<script>
		$("#addStudentForm").submit(function (e) {
			e.preventDefault();

			var dob = new Date($("#age").val());
			var today = new Date();
			var age = today.getFullYear() - dob.getFullYear();
			var m = today.getMonth() - dob.getMonth();
			if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
				age--;
			}

			if (age < 10) {
				alert("Hello! I am an alert box!!");
				window.location.reload()
				return;
			}


			else {
				var studentData = {
					fname: $("#fname").val(),
					lname: $("#lname").val(),
					age: age
				};

				$.ajax({
					url: "http://localhost:8080/StudentInformationSystem/rest/students/create",
					type: 'POST',
					contentType: 'application/json',
					data: JSON.stringify(studentData),
					success: function (result) {
						$("#confirmationMessage").text("Student added successfully!");
						load(); // Reload the student list
						window.location.reload()
					},
					error: function (error) {
						$("#confirmationMessage").text("Failed to add student. Please try again.");
						console.error(error);
					}
				});
			}
		});

		function load() {
			$.ajax({
				url: "http://localhost:8080/StudentInformationSystem/rest/students/allstudent",
				type: 'GET',
				success: function (result) {
					var tableBody = $("#studentsTable tbody");
					tableBody.empty(); // Clear existing rows

					result.forEach(function (student) {
						var row = $("<tr></tr>");
						row.append($("<td></td>").text(student.id));
						row.append($("<td></td>").text(student.fname));
						row.append($("<td></td>").text(student.lname));
						row.append($("<td></td>").text(student.age));
						tableBody.append(row);
					});
				},
				error: function (error) {
					console.error(error);
					$("#confirmationMessage").text("Failed to load students.");
				}
			});
		}
	</script>
</body>

</html>